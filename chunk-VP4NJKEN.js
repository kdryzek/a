import{a as Q}from"./chunk-MS7IIVW6.js";import{C as V,K as q,U as $,X as m,_ as Y,b as z,c as I,ea as y,g as H,hb as E,ib as _,j as J,n as W,p as F,pa as B,uc as b,vc as w,wc as G,xa as C,ya as M}from"./chunk-GQ4PCDYO.js";import{a as r,b as g}from"./chunk-C6Q5SG76.js";function X(n){let t=w(()=>n());return ot(t)?new Proxy(n,{get(i,e){return e in t?(E(i[e])||Object.defineProperty(i,e,{value:b(()=>i()[e]),configurable:!0}),X(i[e])):i[e]}}):n}function ot(n){return n?.constructor===Object}var rt=new WeakMap,l=Symbol("STATE_SOURCE");function d(n,...t){n[l].update(i=>t.reduce((e,s)=>r(r({},e),typeof s=="function"?s(e):s),i)),dt(n)}function at(n){return n[l]()}function ct(n){return rt.get(n[l])||[]}function dt(n){let t=ct(n);for(let i of t){let e=w(()=>at(n));i(e)}}function wt(...n){let t=[...n],i=typeof t[0]=="function"?{}:t.shift(),e=t;return(()=>{class o{constructor(){let a=e.reduce((j,st)=>st(j),lt()),{stateSignals:f,computedSignals:h,methods:p,hooks:S}=a,P=r(r(r({},f),h),p);this[l]=a[l];for(let j in P)this[j]=P[j];let{onInit:v,onDestroy:N}=S;v&&v(),N&&y(M).onDestroy(N)}static \u0275fac=function(f){return new(f||o)};static \u0275prov=Y({token:o,factory:o.\u0275fac,providedIn:i.providedIn||null})}return o})()}function lt(){return{[l]:_({}),stateSignals:{},computedSignals:{},methods:{},hooks:{}}}function x(n,...t){let i=typeof n=="function"?[n,...t]:t;return e=>i.reduce((s,o)=>o(s),e)}function Z(n){return t=>{let i=n(r(r({},t.stateSignals),t.computedSignals));return Object.keys(i),g(r({},t),{computedSignals:r(r({},t.computedSignals),i)})}}function At(n){return t=>{let i=r(r(r({[l]:t[l]},t.stateSignals),t.computedSignals),t.methods),e=typeof n=="function"?n(i):n,s=o=>{let c=e[o],a=t.hooks[o];return c?()=>{a&&a(),c(i)}:a};return g(r({},t),{hooks:{onInit:s("onInit"),onDestroy:s("onDestroy")}})}}function D(n){return t=>{let i=n(r(r(r({[l]:t[l]},t.stateSignals),t.computedSignals),t.methods));return Object.keys(i),g(r({},t),{methods:r(r({},t.methods),i)})}}function K(n){return t=>{let i=typeof n=="function"?n():n,e=Object.keys(i);t[l].update(o=>r(r({},o),i));let s=e.reduce((o,c)=>{let a=b(()=>t[l]()[c]);return g(r({},o),{[c]:X(a)})},{});return g(r({},t),{stateSignals:r(r({},t.stateSignals),s)})}}function k(n,t,i){let e=typeof n=="function"?{next:n,error:t,complete:i}:n;return s=>s.pipe(m({next:e.next,complete:e.complete}),V(o=>(e.error(o),J)),e.finalize?q(e.finalize):o=>o)}var u=function(n){return n[n.None=0]="None",n[n.Entities=1]="Entities",n[n.Both=2]="Both",n}(u||{}),ut=n=>n.id;function O(n){return n?.selectId??ut}function U(n){let t=n?.collection,i=t===void 0?"entityMap":`${t}EntityMap`,e=t===void 0?"ids":`${t}Ids`,s=t===void 0?"entities":`${t}Entities`;return{entityMapKey:i,idsKey:e,entitiesKey:s}}function tt(n,t){return{entityMap:r({},n[t.entityMapKey]),ids:[...n[t.idsKey]]}}function nt(n,t,i){switch(i){case u.Both:return{[t.entityMapKey]:n.entityMap,[t.idsKey]:n.ids};case u.Entities:return{[t.entityMapKey]:n.entityMap};default:return{}}}function ft(n,t,i){let e=i(t);return n.entityMap[e]?u.None:(n.entityMap[e]=t,n.ids.push(e),u.Both)}function pt(n,t,i){let e=i(t);return n.entityMap[e]?(n.entityMap[e]=t,u.Entities):(n.entityMap[e]=t,n.ids.push(e),u.Both)}function yt(n,t,i){let e=u.None;for(let s of t){let o=pt(n,s,i);e!==u.Both&&(e=o)}return e}function ht(n,t,i,e){let s=Array.isArray(t)?t:n.ids.filter(a=>t(n.entityMap[a])),o,c=u.None;for(let a of s){let f=n.entityMap[a];if(f){let h=typeof i=="function"?i(f):i;n.entityMap[a]=r(r({},f),h),c=u.Entities;let p=e(n.entityMap[a]);p!==a&&(n.entityMap[p]=n.entityMap[a],delete n.entityMap[a],o=o||{},o[a]=p)}}return o&&(n.ids=n.ids.map(a=>o[a]??a),c=u.Both),c}function R(n,t){let i=O(t),e=U(t);return s=>{let o=tt(s,e),c=ft(o,n,i);return nt(o,e,c)}}function T(n,t){let i=O(t),e=U(t);return()=>{let s={entityMap:{},ids:[]};return yt(s,n,i),{[e.entityMapKey]:s.entityMap,[e.idsKey]:s.ids}}}function L(n,t){let i=O(t),e=U(t);return s=>{let o=tt(s,e),c=ht(o,[n.id],n.changes,i);return nt(o,e,c)}}function et(n){let{entityMapKey:t,idsKey:i,entitiesKey:e}=U(n);return x(K({[t]:{},[i]:[]}),Z(s=>({[e]:b(()=>{let o=s[t]();return s[i]().map(a=>o[a])})})))}function A(n,t){t?.injector||B(A);let i=t?.injector??y(C),e=new H,s=n(e).subscribe();i.get(M).onDestroy(()=>s.unsubscribe());let o=(c,a)=>{if(gt(c))return e.next(c),{unsubscribe:z};let f=a?.injector??mt()??i;if(E(c)){let p=G(()=>{let P=c();w(()=>e.next(P))},{injector:f}),S={unsubscribe:()=>p.destroy()};return s.add(S),S}let h=c.subscribe(p=>e.next(p));return s.add(h),f!==i&&f.get(M).onDestroy(()=>h.unsubscribe()),h};return o.unsubscribe=s.unsubscribe.bind(s),o}function gt(n){return!E(n)&&!W(n)}function mt(){try{return y(C)}catch{return null}}function Vt(n){return x(K({isCreatePending:!1,isUpdatePending:!1,isLoadAllPending:!1}),et(),D((t,i=y(n))=>({create$:A(I(m(()=>d(t,{isCreatePending:!0})),$(e=>i.create$(e).pipe(k({next:s=>{d(t,R(s),{isCreatePending:!1})},error:s=>alert(JSON.stringify(s)),finalize:()=>d(t,{isCreatePending:!1})}))))),async create(e){d(t,{isCreatePending:!0});let s=await i.create(e);d(t,R(s),{isCreatePending:!1})},update$:A(I(m(()=>d(t,{isUpdatePending:!0})),$(e=>i.update$(e.id,e).pipe(k({next:s=>{console.log(s),d(t,L({id:e.id,changes:e}),{isUpdatePending:!1})},error:s=>alert(JSON.stringify(s)),finalize:()=>d(t,{isUpdatePending:!1})}))))),async update(e){d(t,{isUpdatePending:!0}),await i.update(e.id,e),d(t,L({id:e.id,changes:e}),{isUpdatePending:!1})},loadAll$:A(I(m(()=>d(t,{isLoadAllPending:!0})),$(()=>i.loadAll$().pipe(k({next:e=>d(t,T(e),{isLoadAllPending:!1}),error:e=>console.log("loadAll",e)}))))),async loadAll(){d(t,{isLoadAllPending:!0});let e=await i.loadAll();d(t,T(e),{isLoadAllPending:!1})},getById$(e){let s=t.entityMap()[e];return s?Promise.resolve(s):F(i.loadOne$(e))},async getById(e){let s=t.entityMap()[e];return s?Promise.resolve(s):await i.loadOne(e)}})))}var it=class{httpClient=y(Q);get#t(){return`http://192.168.0.110/${this.path}`}create$(t){return this.httpClient.post(this.#t,t)}async create(t){return await(await fetch(this.#t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})).json()}loadAll$(){return this.httpClient.get(this.#t)}async loadAll(){return await(await fetch(this.#t)).json()}loadOne$(t){return this.httpClient.get(`${this.#t}/${t}`)}async loadOne(t){return await(await fetch(`${this.#t}/${t}`)).json()}update$(t,i){return this.httpClient.patch(`${this.#t}/${t}`,i)}async update(t,i){return await(await fetch(`${this.#t}/${t}`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).json()}delete$(t){this.httpClient.delete(`${this.#t}/${t}`)}};export{wt as a,At as b,Vt as c,it as d};
