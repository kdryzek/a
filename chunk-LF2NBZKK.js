import{da as Q,fa as X}from"./chunk-5KSY6KSG.js";import{Cb as _,Da as W,Db as k,Ea as q,Hc as J,Kb as K,Xb as U,b as T,bc as B,cc as G,ec as H,fc as z,h as M,ia as D,ib as I,ub as V}from"./chunk-GQ4PCDYO.js";import{d as pe,e as ve}from"./chunk-C6Q5SG76.js";var fe=pe((xe,C)=>{"use strict";var p=typeof Reflect=="object"?Reflect:null,Y=p&&typeof p.apply=="function"?p.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},m;p&&typeof p.ownKeys=="function"?m=p.ownKeys:Object.getOwnPropertySymbols?m=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:m=function(t){return Object.getOwnPropertyNames(t)};function me(e){console&&console.warn&&console.warn(e)}var ee=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}C.exports=a;C.exports.once=$e;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;var Z=10;function h(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return Z},set:function(e){if(typeof e!="number"||e<0||ee(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Z=e}});a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ee(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function te(e){return e._maxListeners===void 0?a.defaultMaxListeners:e._maxListeners}a.prototype.getMaxListeners=function(){return te(this)};a.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var f=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw f.context=s,f}var v=o[t];if(v===void 0)return!1;if(typeof v=="function")Y(v,this,n);else for(var j=v.length,de=oe(v,j),r=0;r<j;++r)Y(de[r],this,n);return!0};function ne(e,t,n,r){var i,o,s;if(h(n),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),s===void 0)s=o[t]=n,++e._eventsCount;else if(typeof s=="function"?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),i=te(e),i>0&&s.length>i&&!s.warned){s.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=s.length,me(f)}return e}a.prototype.addListener=function(t,n){return ne(this,t,n,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(t,n){return ne(this,t,n,!0)};function he(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function re(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=he.bind(r);return i.listener=n,r.wrapFn=i,i}a.prototype.once=function(t,n){return h(n),this.on(t,re(this,t,n)),this};a.prototype.prependOnceListener=function(t,n){return h(n),this.prependListener(t,re(this,t,n)),this};a.prototype.removeListener=function(t,n){var r,i,o,s,f;if(h(n),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){f=r[s].listener,o=s;break}if(o<0)return this;o===0?r.shift():ge(r,o),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,f||n)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(t){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),s;for(i=0;i<o.length;++i)s=o[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(t,n[i]);return this};function ie(e,t,n){var r=e._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?be(i):oe(i,i.length)}a.prototype.listeners=function(t){return ie(this,t,!0)};a.prototype.rawListeners=function(t){return ie(this,t,!1)};a.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):se.call(e,t)};a.prototype.listenerCount=se;function se(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?m(this._events):[]};function oe(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function ge(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function be(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function $e(e,t){return new Promise(function(n,r){function i(s){e.removeListener(t,o),r(s)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),n([].slice.call(arguments))}ae(e,t,o,{once:!0}),t!=="error"&&ye(e,i,{once:!0})})}function ye(e,t,n){typeof e.on=="function"&&ae(e,"error",t,n)}function ae(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}});var ue=ve(fe(),1);function c(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var l={};c(l,"nfcEvents",()=>u);c(l,"deviceSupportsNFC",()=>O);c(l,"deviceAllowsNFC",()=>ce);c(l,"requestAccessToNFC",()=>R);c(l,"isReadingTags",()=>Le);c(l,"isWritingTags",()=>Te);c(l,"stopReadingFromTags",()=>S);c(l,"stopWritingToTag",()=>A);c(l,"listenForTags",()=>w);c(l,"readFromTag",()=>L);c(l,"writeToTag",()=>Ee);var d,g,E,b=!1,$=!1,x,N,y,F,we=2500,u=new ue.EventEmitter,O=async function(){return"NDEFReader"in window},ce=async function(){return(await navigator.permissions.query({name:"nfc"})).state==="granted"},R=async function(){d||(d=new NDEFReader);let e=new AbortController;await d.scan({signal:e.signal}),await e.abort("completed permission request"),ce()?u.emit("PermissionGranted"):u.emit("PermissionDenied")},Le=async function(){return b},Te=async function(){return $},S=async function(e){b&&(g&&(clearTimeout(g),g=void 0),await x.abort(e),b=!1,clearTimeout(F),y=void 0,u.emit("ReadStop",e))},A=async function(e){$&&(E&&clearTimeout(E),N.abort(e),$=!1,u.emit("WriteStop",e))},P=async function(e){await S(e),await A(e)},_e=async function(){y=void 0},le=async function(e){let{serialNumber:t,message:n}=e,{records:r}=n;if(t===y){u.emit("TagIgnored",t);return}y=t,clearTimeout(F),F=setTimeout(_e,we),u.emit("TagDetected",t),u.emit("TagRecords",r)},Ce=async function(e){await le(e),await P("completed read operation")},w=async function(e=0,t=!1){d||(d=new NDEFReader),d.onreading=t?Ce:le,await P("starting read operation"),x=new AbortController,await d.scan({signal:x.signal}),b=!0,u.emit("ReadStart"),e&&(g=setTimeout(S.bind(null,"read operation timed out"),e*1e3))},L=async function(e=0){return w(e,!0)},Ee=async function(e,t,n=!1,r=0){d||(d=new NDEFReader),await P("starting write operation"),N=new AbortController;let i={overwrite:n,signal:N.signal},s={records:[{recordType:"mime",mediaType:e,data:t}]},f=d.write(s,i);return $=!0,u.emit("WriteStart"),r&&(E=setTimeout(A.bind(null,"write operation timed out"),r*1e3)),f};var We=(()=>{class e{readValue=W();mode=q("single");#t=I("");#e=T;#n=T;disabled$=new M(!1);writeValue(n){this.#t.set(n)}registerOnChange(n){this.#e=n}registerOnTouched(n){this.#n=n}setDisabledState(n){this.disabled$.next(n)}async read(){await O()?(await R(),u.on("TagDetected",r=>{this.#e(r),this.readValue.emit(r)}),await L(5)):alert("nfc niedostepne")}async#r(){await L(5)}async#i(){await w()}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=D({type:e,selectors:[["lib-nfc"]],inputs:{mode:[1,"mode"]},outputs:{readValue:"readValue"},standalone:!0,features:[B([{provide:X,multi:!0,useExisting:e}]),G],decls:4,vars:3,consts:[["type","button",3,"click","disabled"]],template:function(r,i){r&1&&(_(0,"button",0),H(1,"async"),K("click",function(){return i.read()}),_(2,"mat-icon"),U(3,"nfc"),k()()),r&2&&V("disabled",z(1,1,i.disabled$))},dependencies:[Q,J],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0})}return e})();export{We as a};
